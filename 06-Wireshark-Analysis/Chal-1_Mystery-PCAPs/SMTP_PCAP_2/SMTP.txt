

SMTP
SMTP is a connection-oriented, text-based protocol, simple mail transfer protocol, which was originally communicated over port '25'. SMTP cam about in the begingin of ARPANET, as standards were developed to permit exchange of messages between different operating systems; this is where SMTP branched out from. An email is submitted by a mail client ( mail user agent, MUA ) to a mail server ( mail submission agent, MSA ). This communication is done using SMTP on  TCP port 587, but can be accepted by some mailbox providers on port 25. The MSA delivers the mail to its ( mail transfer agent, MTA) which often are the same instance launched with different options. Local processing is possible using SMTP, using each the next machine as a smart host. A smart host is a machine which acts as a router to other mail, routing mail to the email recipients' email servers. The MTA uses DNS to look up the MX record ( mail exchanger record, the part ont he right after the '@' on an email address ). The MX record contains the name of the targer host. Message transfer works like packet routing, where it can take one hop or multiple hops until it reaches it's target. Once reaching the final hop the message is handed off to a ( mail delivery agent, MDA ) for local delivery. The MDA saves messages in the relevant mailbox format. SMTP Defines the message transport, this does not consist of the message cotnent. 

An SMTP transaction consists of three command/reply sequences: MAIL, RCPT, DATA. The 'MAIL' Command to establish the return address. The 'RCPT' command is used to establust a recipient of the message. RCPT can be used multiple times for each recipient. The 'DATA' is to signal the beginning of the message text, it is the content of the message. 'DATA' is a group of commands, the server replies twice, once to the 'DATA' command to acknowledge that it is ready to recieve the text/ body of the message. The second time 'DATA' is sent is to determine if to either accept or reject the message sent. The initiating the host of the SMTP client can be done almost anywhere in the stream. SMTP is a mail delivery protocol only, it works in pushes not pulls, it is more used for routing based on the destination server, not the individual users. 'POP' and 'IMAP' are more specifically designed for individual users. A general stream of the SMTP protocol starts with a 'HELO','MAIL','RCPT', 'RCPT','DATA', some text being send, '.','250 OK', 'BYE'. 



The server responses and the client responses are represented by the 'S' and the 'C' at the begining of each line. The session begins with a tcp handshake, and then the server sends a response '220 ready' saying that it is ready for commands. The client then sends a 'HELO' and then on the same packet tells the server what mails server to create a path to. The server then responds with a '250' ok, and the address in which to use as a sender name. The client then issues a 'MAIL FROM' command which is followed by the address to be used as the sender, then a '250 okay' and then the client sends a response to the server in which the '[RCPT]' is set. The sender in this case as assigned by the server is '31337@musecurity.com' and the recipient is also '31337@musecurity.com'. The Mail User or client sends themselves a message. The contents of the messgae seemingly a text file with the contents of the message inside it. The mail server closes the push submission asking what the message is and the subject identifying it as it being sent from the MAIL USER, 'mu@musecurity' and sets the subject to the the username or identifying name '31337'. 

This conversation is seen multiple times on the stream. As a new TCP connection is created fro each session of the SMTP messaging stream, the same IP as the source and the destination remain. Using the same IP address as the source and destination, as well as the same recipient and sender throughout the stream, it is clear to deduct that this stream is a message being sent to oneself using SMTP. The recieving port on the computer changes each session as the computer sends its data from another port each time, but consistnetly to the SMTP port '25'. The mail users uses the SMTP protocol on their computer to send the SMTP protocol to their loopback IP. The TCP connection is established between '127.0.0.1' and '127.0.0.1'. The size of the packets being sent in the TCP handshake stem from '54-85' bits per packet. The message sent is ranged from '418-425' bits per packet.

